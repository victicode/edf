import{r as c,G as X,e as d,g as a,w as r,K as Z,N as ee,q as te,o as n,T as Y,i as v,F as N,j as se,f as t,t as u,A as h,n as q,l as B,D as oe,v as S,B as V,x as y,H as le}from"./index-BSBF4jGH.js";import{Q as ae}from"./QDate-BLdu9_3G.js";import{Q as T}from"./QPopupProxy-C_r6gXi9.js";import{Q as b}from"./QInput-CCszA-Cu.js";import{Q as H}from"./QTime-6RwcKHVB.js";import{Q as ie}from"./QCheckbox-RjCswHd1.js";import{Q as re}from"./QForm-n8jT9PtN.js";import{Q as ne}from"./QSpinnerDots-C4tArpGa.js";import{C as D}from"./ClosePopup-CTuEMMh8.js";import{u as de}from"./comunArea.store-BuWp1D4-.js";import{u as ue}from"./reserve.store-B7o8BB79.js";import{h as L}from"./moment-BLMuvzoS.js";import"./use-render-cache-DLxPkVnQ.js";import"./use-key-composition-Z-2-MGMt.js";import"./use-id-BKlrVpl6.js";import"./format-CoaQEihs.js";import"./QMenu-DSB_uF9S.js";import"./position-engine-DU4jhfDu.js";import"./TouchPan-DZJlNQpP.js";import"./option-sizes-Bdbpte1t.js";const me={class:"md:px-20 md:mx-16 h-full",style:{overflow:"hidden",position:"relative"}},ce={key:0,class:"h-full"},ve={key:0,class:"px-3 pt-5"},pe=["onClick"],_e={class:"col-10"},fe={class:"text-subtitle1 text-black q-mt-xs",style:{"line-height":"1.2","font-weight":"500"}},ye={class:"q-mt-xs text-body2 text-black",style:{"font-weight":"500"}},xe={key:0},he={key:0,class:"h-full",style:{overflow:"hidden"}},be={class:"w-full h-full"},ge={style:{height:"84%",overflow:"auto"},class:"pb-5"},we={class:"row w-full pt-5"},ke={class:"col-12 px-3"},Se={class:"w-full row selectAreaItem items-center mb-5 pr-4 pl-2 md:px-4 py-2"},Ve={class:"text-subtitle1 text-black q-pt-xs col-10 pl-1",style:{"line-height":"1.2","font-weight":"500"}},Te={class:"col-12 row mt-1"},De={class:"col-3 col-md-1 bg-primary flex flex-center py-1",style:{"border-radius":"0.5rem"}},Me=["innerHTML"],Ce={class:"col-8 pl-2"},Ae={class:"q-mt-xs text-body2x text-black",style:{"font-weight":"500"}},Qe={key:0,style:{"font-weight":"500"}},Re={class:"q-mt-xs text-body2x text-black",style:{"font-weight":"500"}},ze={class:"q-mt-xs text-body2x text-black",style:{"font-weight":"500"}},Fe={class:"col-12 col-md-6 row"},Ye={class:"col-12 row md:px-5"},Ne={class:"col-12 row mt-3 px-3 md:px-2"},qe={class:"col-12"},Be={class:"row items-center justify-end"},He={class:"col-12 row md:px-5"},Le={class:"col-12 row mt-3 px-3 md:px-2"},Ue={class:"col-6 pr-2 md:pr-4"},Ie={class:"row items-center justify-end"},je={class:"col-6 pl-2 md:pl-4"},Je={class:"row items-center justify-end"},Oe={key:0,class:"col-12 row mt-0 px-3 md:px-2"},Pe={class:"col-12 col-md-6 md:px-5"},Ee={class:"col-12 row mt-3 px-3 md:px-2"},Ge=["innerHTML"],$e={key:1,class:"col-12 col-md-6 row md:px-5"},Ke={class:"col-12 row mt-3 px-3 md:px-2"},We={class:"col-12"},Xe={style:{height:"17%"},class:"buttonSection"},Ze={class:"row py-4"},et={class:"col-12 pb-4 px-5"},tt={class:"w-full flex justify-between text-black"},st={style:{"font-weight":"500","font-size":"1.1rem"}},ot={class:"col-6 flex flex-center"},lt={class:"col-6 flex flex-center"},at={class:"py-1 md:py-1"},it={key:1,class:"flex flex-center py-24 w-full"},Mt={__name:"createReserve",setup(rt){const U={days:"Domingo_Lunes_Martes_Miércoles_Jueves_Viernes_Sábado".split("_"),daysShort:"Dom_Lun_Mar_Mié_Jue_Vie_Sáb".split("_"),months:"Enero_Febrero_Marzo_Abril_Mayo_Junio_Julio_Agosto_Septiembre_Octubre_Noviembre_Diciembre".split("_"),monthsShort:"Ene_Feb_Mar_Abr_May_Jun_Jul_Ago_Sep_Oct_Nov_Dic".split("_"),firstDayOfWeek:1,format24h:!0,pluralDay:"dias"},I=de(),M=ue(),g=Z("emitter"),w=c([]),i=c({}),C=te(),p=c(!0),A=c(!1),x=c(!1),m=c(1),o=c({date:"",time_from:"",time_to:"",note:"",is_exclusive:!1}),Q=c([]),_=c([]),R=c([0]),z=c([]),j=l=>{i.value=w.value.find(e=>e.id==l),F()},J=()=>{m.value==2&&O(),m.value--,g.emit("pagTitle","Selecciona area común")},F=()=>{if(m.value==3){W();return}g.emit("pagTitle",m.value==1?"Agenda tu reserva":"Realiza el pago"),m.value++},O=()=>{o.value={date:"",time_from:"",time_to:"",note:"",is_exclusive:!1},p.value=!0},P=()=>{g.emit("pagTitle","Selecciona area común"),I.getAllComunAreas().then(l=>{if(l.code!==200)throw l;w.value=l.data,setTimeout(()=>{A.value=!0},100)}).catch(l=>{k("positive","Error al obtener areas comunes")})},E=()=>{const l={idArea:i.value.id,date:o.value.date};M.getAvailableReserveInDayByArea(l).then(e=>{p.value=!1,Q.value=e.data.availableFrom,z.value=e.data.availableTo})},G=l=>l>=L().format("YYYY/MM/DD"),$=()=>{if(!o.value.time_from){o.value.time_to="",_.value=[];return}const l=parseInt(o.value.time_from.substring(0,2)),e=Number(i.value.max_time_reserve||0),s=[];for(let f=1;f<=e;f++)s.push(l+f);_.value=z.value.filter(f=>s.includes(f)),K()},K=()=>{if(_.value.length>0){const l=_.value[_.value.length-1],e=String(l).padStart(2,"0");o.value.time_to=`${e}:00`}else o.value.time_to=""},k=(l,e)=>{ee.create({color:l,message:e,timeout:2e3})},W=()=>{o.value.comun_area=i.value.id,o.value.amount=i.value.price+i.value.warranty_price,o.value.exclusive=o.value.is_exclusive?1:0,x.value=!0,M.createReserve(o.value).then(l=>{console.log(l),setTimeout(()=>{if(x.value=!1,k("positive","Reserva realizada con exito"),!l.data.toPay){C.push("/client/reserves/confirm-reserve/"+l.data.id);return}C.push("/client/reserves/pay-reserve/"+l.data.id)},2e3)}).catch(l=>{console.log(l),setTimeout(()=>{x.value=!1,k("negative","Error al realizar reserva")},2e3)})};return X(()=>{P()}),(l,e)=>(n(),d("div",me,[A.value?(n(),d("div",ce,[a(re,{onSubmit:e[9]||(e[9]=s=>F()),class:"h-full"},{default:r(()=>[a(Y,{name:"horizontal"},{default:r(()=>[m.value==1?(n(),d("div",ve,[(n(!0),d(N,null,se(w.value,s=>(n(),d("div",{class:"row selectAreaItem items-center mb-5 px-4 md:px-5 md:py-5 py-3",key:s.id,onClick:f=>j(s.id)},[t("div",_e,[t("div",fe,u(s.name),1),t("div",ye,[h(" Costo: S/"+u(s.price)+" ",1),s.warranty_price>0?(n(),d("i",xe,[h(" + S/"+u(s.warranty_price)+" ",1),e[10]||(e[10]=t("span",{class:"text-warning",style:{"font-size":"0.75rem"}},"garantia",-1))])):v("",!0)])]),t("div",{class:q(["col-2 text-bold text-end",{"text-positive":s.pay_label=="Gratis","text-primary":s.pay_label=="Pago"}]),style:{"font-size":"0.988rem"}},u(s.pay_label),3)],8,pe))),128))])):v("",!0)]),_:1}),a(Y,{name:"horizontal"},{default:r(()=>[m.value>1?(n(),d("div",he,[t("div",be,[t("div",ge,[t("div",we,[t("div",ke,[t("div",Se,[t("div",Ve,u(i.value.name),1),t("div",{class:q(["text-subtitle2 text-white px-6",{"bg-primary":i.value.pay_label=="Pago","bg-positive":i.value.pay_label=="Gratis"}]),style:{position:"absolute",top:"0",right:"0","border-bottom-left-radius":"1rem","letter-spacing":"1px"}},u(i.value.pay_label),3),t("div",Te,[t("div",De,[t("div",null,[t("div",{innerHTML:B(oe)[i.value.icon]},null,8,Me)])]),t("div",Ce,[t("div",Ae,[h(" Costo: S/"+u(i.value.price)+" ",1),i.value.warranty_price>0?(n(),d("i",Qe,[h(" + S/"+u(i.value.warranty_price)+" ",1),e[11]||(e[11]=t("span",{class:"text-warning",style:{"font-size":"0.75rem"}},"garantia",-1))])):v("",!0)]),t("div",Re," Capcidad: "+u(i.value.capacity)+" personas ",1),t("div",ze," Max. de reserva: "+u(i.value.max_time_reserve)+" hora(s) ",1)])])])]),m.value==2?(n(),d(N,{key:0},[t("div",Fe,[t("div",Ye,[e[13]||(e[13]=t("div",{class:"col-12 text-subtitle1 headerSection my-1 py-2 px-4"}," Selecciona la fecha ",-1)),t("div",Ne,[t("div",qe,[e[12]||(e[12]=t("div",{class:"text-subtitle2 text-black",style:{"font-weight":"medium"}}," Fecha de reserva: ",-1)),a(b,{modelValue:o.value.date,"onUpdate:modelValue":e[1]||(e[1]=s=>o.value.date=s),rules:[s=>!!s||"Fecha es requerida"],dense:"",borderless:"",clearable:"",class:"form__inputsReverse mt-1",color:"primary"},{append:r(()=>[a(S,{name:"eva-calendar-outline",class:"cursor-pointer"},{default:r(()=>[a(T,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:r(()=>[a(ae,{mask:"DD-MM-YYYY",modelValue:o.value.date,"onUpdate:modelValue":[e[0]||(e[0]=s=>o.value.date=s),E],options:G,"navigation-min-year-month":B(L)().format("YYYY/MM"),locale:U},{default:r(()=>[t("div",Be,[V(a(y,{label:"Aceptar",color:"primary",flat:""},null,512),[[D]])])]),_:1},8,["modelValue","navigation-min-year-month"])]),_:1})]),_:1})]),_:1},8,["modelValue","rules"])])])]),t("div",He,[e[17]||(e[17]=t("div",{class:"col-12 text-subtitle1 headerSection my-1 py-2 px-4"}," Selecciona la hora ",-1)),t("div",Le,[t("div",Ue,[e[14]||(e[14]=t("div",{class:"text-subtitle2 text-black",style:{"font-weight":"medium"}}," Desde: ",-1)),a(b,{modelValue:o.value.time_from,"onUpdate:modelValue":e[3]||(e[3]=s=>o.value.time_from=s),mask:"time",rules:["time"],dense:"",borderless:"",clearable:"",class:"form__inputsReverse mt-1 q-pb-sm",color:"primary",readonly:p.value,disable:p.value},{append:r(()=>[a(S,{name:"eva-clock-outline",class:"cursor-pointer"},{default:r(()=>[a(T,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:r(()=>[a(H,{modelValue:o.value.time_from,"onUpdate:modelValue":[e[2]||(e[2]=s=>o.value.time_from=s),$],"hour-options":Q.value,"minute-options":R.value,format24h:""},{default:r(()=>[t("div",Ie,[V(a(y,{label:"Aceptar",color:"primary",flat:""},null,512),[[D]])])]),_:1},8,["modelValue","hour-options","minute-options"])]),_:1})]),_:1})]),_:1},8,["modelValue","readonly","disable"])]),t("div",je,[e[15]||(e[15]=t("div",{class:"text-subtitle2 text-black",style:{"font-weight":"medium"}}," Hasta: ",-1)),a(b,{modelValue:o.value.time_to,"onUpdate:modelValue":e[5]||(e[5]=s=>o.value.time_to=s),mask:"time",rules:["time"],dense:"",borderless:"",clearable:"",class:"form__inputsReverse mt-1 q-pb-sm",color:"primary",readonly:p.value,disable:p.value},{append:r(()=>[a(S,{name:"eva-clock-outline",class:"cursor-pointer"},{default:r(()=>[a(T,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:r(()=>[a(H,{modelValue:o.value.time_to,"onUpdate:modelValue":e[4]||(e[4]=s=>o.value.time_to=s),format24h:"","hour-options":_.value,"minute-options":R.value},{default:r(()=>[t("div",Je,[V(a(y,{label:"Aceptar",color:"primary",flat:""},null,512),[[D]])])]),_:1},8,["modelValue","hour-options","minute-options"])]),_:1})]),_:1})]),_:1},8,["modelValue","readonly","disable"])])]),i.value.type==2?(n(),d("div",Oe,[a(ie,{modelValue:o.value.is_exclusive,"onUpdate:modelValue":e[6]||(e[6]=s=>o.value.is_exclusive=s),color:"primary"},{default:r(()=>[...e[16]||(e[16]=[t("div",{class:"text-grey-9 mt-1"}," Reservar de forma exclusiva ",-1)])]),_:1},8,["modelValue"])])):v("",!0)])]),t("div",Pe,[e[18]||(e[18]=t("div",{class:"w-full text-subtitle1 headerSection my-1 py-2 px-4"}," Reglas ",-1)),t("div",Ee,[t("div",{class:"text-grey-9",style:{"font-size":"0.95rem","line-height":"1.7"},innerHTML:i.value.format_rules},null,8,Ge)])])],64)):v("",!0),m.value==3?(n(),d("div",$e,[e[20]||(e[20]=t("div",{class:"col-12 text-subtitle1 headerSection my-1 py-2 px-4"}," Información adicional de reserva ",-1)),t("div",Ke,[t("div",We,[e[19]||(e[19]=t("div",{class:"text-subtitle2 text-black",style:{"font-weight":"medium"}}," Notas ",-1)),a(b,{dense:"",borderless:"",clearable:"",type:"textarea",modelValue:o.value.note,"onUpdate:modelValue":e[7]||(e[7]=s=>o.value.note=s),class:"form__inputsReverse mt-1",color:"primary"},null,8,["modelValue"])])])])):v("",!0)])]),t("div",Xe,[t("div",Ze,[t("div",et,[t("div",tt,[e[21]||(e[21]=t("div",{style:{"font-weight":"500","font-size":"1.1rem"}},"Total a pagar:",-1)),t("div",st,"S/"+u(i.value.price+i.value.warranty_price),1)])]),t("div",ot,[m.value>1?(n(),le(y,{key:0,color:"grey-8",class:"",style:{width:"90%","border-radius":"0.5rem"},onClick:e[8]||(e[8]=s=>J())},{default:r(()=>[...e[22]||(e[22]=[t("div",{class:"py-1 md:py-1"}," Volver ",-1)])]),_:1})):v("",!0)]),t("div",lt,[a(y,{color:"primary",class:"",style:{width:"90%","border-radius":"0.5rem"},type:"submit",loading:x.value},{default:r(()=>[t("div",at,u(m.value==3?"Guardar reserva":"Siguiente"),1)]),_:1},8,["loading"])])])])])])):v("",!0)]),_:1})]),_:1})])):(n(),d("div",it,[a(ne,{color:"primary",size:"7rem"})]))]))}};export{Mt as default};
