import{U as $,r as E,b as c,an as K,Z as w,ai as M,h as F,c as X,a7 as Y,am as Z}from"./index-BSBF4jGH.js";import{Q as G}from"./QChip-C5Fpsmun.js";import{c as H,u as J,j as ee,g as te,e as le,f as U,i as ne}from"./use-key-composition-Z-2-MGMt.js";import{u as ie}from"./QInput-CCszA-Cu.js";import{h as ae}from"./format-CoaQEihs.js";function x(e,f,S,b){const u=[];return e.forEach(s=>{b(s)===!0?u.push(s):f.push({failedPropValidation:S,file:s})}),u}function P(e){e!=null&&e.dataTransfer&&(e.dataTransfer.dropEffect="copy"),w(e)}const ue={multiple:Boolean,accept:String,capture:String,maxFileSize:[Number,String],maxTotalSize:[Number,String],maxFiles:[Number,String],filter:Function},re=["rejected"];function se({editable:e,dnd:f,getFileInput:S,addFilesToQueue:b}){const{props:u,emit:s,proxy:h}=$(),y=E(null),z=c(()=>u.accept!==void 0?u.accept.split(",").map(t=>(t=t.trim(),t==="*"?"*/":(t.endsWith("/*")&&(t=t.slice(0,t.length-1)),t.toUpperCase()))):null),V=c(()=>parseInt(u.maxFiles,10)),j=c(()=>parseInt(u.maxTotalSize,10));function N(t){var m;if(e.value)if(t!==Object(t)&&(t={target:null}),((m=t.target)==null?void 0:m.matches('input[type="file"]'))===!0)t.clientX===0&&t.clientY===0&&K(t);else{const v=S();v!==t.target&&(v==null||v.click(t))}}function _(t){e.value&&t&&b(null,t)}function k(t,m,v,C){let n=Array.from(m||t.target.files);const d=[],p=()=>{d.length!==0&&s("rejected",d)};if(u.accept!==void 0&&z.value.indexOf("*/")===-1&&(n=x(n,d,"accept",i=>z.value.some(r=>i.type.toUpperCase().startsWith(r)||i.name.toUpperCase().endsWith(r))),n.length===0))return p();if(u.maxFileSize!==void 0){const i=parseInt(u.maxFileSize,10);if(n=x(n,d,"max-file-size",r=>r.size<=i),n.length===0)return p()}if(u.multiple!==!0&&n.length!==0&&(n=[n[0]]),n.forEach(i=>{i.__key=i.webkitRelativePath+i.lastModified+i.name+i.size}),C===!0){const i=v.map(r=>r.__key);n=x(n,d,"duplicate",r=>i.includes(r.__key)===!1)}if(n.length===0)return p();if(u.maxTotalSize!==void 0){let i=C===!0?v.reduce((r,T)=>r+T.size,0):0;if(n=x(n,d,"max-total-size",r=>(i+=r.size,i<=j.value)),n.length===0)return p()}if(typeof u.filter=="function"){const i=u.filter(n);n=x(n,d,"filter",r=>i.includes(r))}if(u.maxFiles!==void 0){let i=C===!0?v.length:0;if(n=x(n,d,"max-files",()=>(i++,i<=V.value)),n.length===0)return p()}if(p(),n.length!==0)return n}function I(t){P(t),f.value!==!0&&(f.value=!0)}function a(t){w(t),(t.relatedTarget!==null||M.is.safari!==!0?t.relatedTarget!==y.value:document.elementsFromPoint(t.clientX,t.clientY).includes(y.value)===!1)===!0&&(f.value=!1)}function A(t){P(t);const m=t.dataTransfer.files;m.length!==0&&b(null,m),f.value=!1}function O(t){if(f.value===!0)return F("div",{ref:y,class:`q-${t}__dnd absolute-full`,onDragenter:P,onDragover:P,onDragleave:a,onDrop:A})}return Object.assign(h,{pickFiles:N,addFiles:_}),{pickFiles:N,addFiles:_,onDragover:I,onDragleave:a,processFiles:k,getDndNode:O,maxFilesNumber:V,maxTotalSizeNumber:j}}const ve=X({name:"QFile",inheritAttrs:!1,props:{...ee,...J,...ue,modelValue:[File,FileList,Array],append:Boolean,useChips:Boolean,displayValue:[String,Number],tabindex:{type:[String,Number],default:0},counterLabel:Function,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[...H,...re],setup(e,{slots:f,emit:S,attrs:b}){const{proxy:u}=$(),s=te(),h=E(null),y=E(!1),z=le(e),{pickFiles:V,onDragover:j,onDragleave:N,processFiles:_,getDndNode:k}=se({editable:s.editable,dnd:y,getFileInput:Q,addFilesToQueue:R}),I=ie(e),a=c(()=>Object(e.modelValue)===e.modelValue?"length"in e.modelValue?Array.from(e.modelValue):[e.modelValue]:[]),A=c(()=>U(a.value)),O=c(()=>a.value.map(l=>l.name).join(", ")),t=c(()=>ae(a.value.reduce((l,o)=>l+o.size,0))),m=c(()=>({totalSize:t.value,filesNumber:a.value.length,maxFiles:e.maxFiles})),v=c(()=>({tabindex:-1,type:"file",title:"",accept:e.accept,capture:e.capture,name:z.value,...b,id:s.targetUid.value,disabled:s.editable.value!==!0})),C=c(()=>"q-file q-field--auto-height"+(y.value===!0?" q-file--dnd":"")),n=c(()=>e.multiple===!0&&e.append===!0);function d(l){const o=a.value.slice();o.splice(l,1),i(o)}function p(l){const o=a.value.indexOf(l);o!==-1&&d(o)}function i(l){S("update:modelValue",e.multiple===!0?l:l[0])}function r(l){l.keyCode===13&&Z(l)}function T(l){(l.keyCode===13||l.keyCode===32)&&V(l)}function Q(){return h.value}function R(l,o){const g=_(l,o,a.value,n.value),q=Q();q!=null&&(q.value=""),g!==void 0&&((e.multiple===!0?e.modelValue&&g.every(W=>a.value.includes(W)):e.modelValue===g[0])||i(n.value===!0?a.value.concat(g):g))}function D(){return[F("input",{class:[e.inputClass,"q-file__filler"],style:e.inputStyle})]}function B(){if(f.file!==void 0)return a.value.length===0?D():a.value.map((o,g)=>f.file({index:g,file:o,ref:this}));if(f.selected!==void 0)return a.value.length===0?D():f.selected({files:a.value,ref:this});if(e.useChips===!0)return a.value.length===0?D():a.value.map((o,g)=>F(G,{key:"file-"+g,removable:s.editable.value,dense:!0,textColor:e.color,tabindex:e.tabindex,onRemove:()=>{d(g)}},()=>F("span",{class:"ellipsis",textContent:o.name})));const l=e.displayValue!==void 0?e.displayValue:O.value;return l.length!==0?[F("div",{class:e.inputClass,style:e.inputStyle,textContent:l})]:D()}function L(){const l={ref:h,...v.value,...I.value,class:"q-field__input fit absolute-full cursor-pointer",onChange:R};return e.multiple===!0&&(l.multiple=!0),F("input",l)}return Object.assign(s,{fieldClass:C,emitValue:i,hasValue:A,inputRef:h,innerValue:a,floatingLabel:c(()=>A.value===!0||U(e.displayValue)),computedCounter:c(()=>{if(e.counterLabel!==void 0)return e.counterLabel(m.value);const l=e.maxFiles;return`${a.value.length}${l!==void 0?" / "+l:""} (${t.value})`}),getControlChild:()=>k("file"),getControl:()=>{const l={ref:s.targetRef,class:"q-field__native row items-center cursor-pointer",tabindex:e.tabindex};return s.editable.value===!0&&Object.assign(l,{onDragover:j,onDragleave:N,onKeydown:r,onKeyup:T}),F("div",l,[L()].concat(B()))}}),Object.assign(u,{removeAtIndex:d,removeFile:p,getNativeElement:()=>h.value}),Y(u,"nativeEl",()=>h.value),ne(s)}});export{ve as Q};
