import{c as He,S as Ae,U as Ie,V as Ke,r as P,b as c,E as ne,$ as Te,a0 as Be,d as Pe,h as s,a1 as Fe,T as $e,B as je,x as Ne}from"./index-BSBF4jGH.js";import{T as Qe}from"./TouchPan-DZJlNQpP.js";import{u as Ye,b as ze,a as Le}from"./use-key-composition-Z-2-MGMt.js";import{u as ae,a as Ee,b as Ue,_ as F,g as We,f as Xe}from"./QPopupProxy-C_r6gXi9.js";import{p as k}from"./format-CoaQEihs.js";function Ge(u,U){return u.hour!==null&&u.minute===null?"minute":"hour"}function Je(){const u=new Date;return{hour:u.getHours(),minute:u.getMinutes(),second:u.getSeconds(),millisecond:u.getMilliseconds()}}const lt=He({name:"QTime",props:{...Ae,...Ye,...ae,modelValue:{required:!0,validator:u=>typeof u=="string"||u===null},mask:{...ae.mask,default:null},format24h:{type:Boolean,default:null},defaultDate:{type:String,validator:u=>/^-?[\d]+\/[0-1]\d\/[0-3]\d$/.test(u)},options:Function,hourOptions:Array,minuteOptions:Array,secondOptions:Array,withSeconds:Boolean,nowBtn:Boolean},emits:Ee,setup(u,{slots:U,emit:oe}){const $=Ie(),{$q:y}=$.proxy,ie=Ke(u,y),{tabindex:g,headerClass:W,getLocale:se,getCurrentDate:X}=Ue(u,y),re=ze(u),ce=Le(re);let M,x;const G=P(null),D=c(()=>_e()),S=c(()=>se()),J=c(()=>ge()),p=F(u.modelValue,D.value,S.value,u.calendar,J.value),i=P(Ge(p)),l=P(p),v=P(p.hour===null||p.hour<12),ve=c(()=>`q-time q-time--${u.landscape===!0?"landscape":"portrait"}`+(ie.value===!0?" q-time--dark q-dark":"")+(u.disable===!0?" disabled":u.readonly===!0?" q-time--readonly":"")+(u.bordered===!0?" q-time--bordered":"")+(u.square===!0?" q-time--square no-border-radius":"")+(u.flat===!0?" q-time--flat no-shadow":"")),j=c(()=>{const e=l.value;return{hour:e.hour===null?"--":f.value===!0?k(e.hour):String(v.value===!0?e.hour===0?12:e.hour:e.hour>12?e.hour-12:e.hour),minute:e.minute===null?"--":k(e.minute),second:e.second===null?"--":k(e.second)}}),f=c(()=>u.format24h!==null?u.format24h:y.lang.date.format24h),de=c(()=>{const e=i.value==="hour",t=e===!0?12:60,n=l.value[i.value];let r=`rotate(${Math.round(n*(360/t))-180}deg) translateX(-50%)`;return e===!0&&f.value===!0&&l.value.hour>=12&&(r+=" scale(.7)"),{transform:r}}),Z=c(()=>l.value.hour!==null),fe=c(()=>Z.value===!0&&l.value.minute!==null),q=c(()=>u.hourOptions!==void 0?e=>u.hourOptions.includes(e):u.options!==void 0?e=>u.options(e,null,null):null),O=c(()=>u.minuteOptions!==void 0?e=>u.minuteOptions.includes(e):u.options!==void 0?e=>u.options(l.value.hour,e,null):null),V=c(()=>u.secondOptions!==void 0?e=>u.secondOptions.includes(e):u.options!==void 0?e=>u.options(l.value.hour,l.value.minute,e):null),h=c(()=>{if(q.value===null)return null;const e=A(0,11,q.value),t=A(12,11,q.value);return{am:e,pm:t,values:e.values.concat(t.values)}}),b=c(()=>O.value!==null?A(0,59,O.value):null),w=c(()=>V.value!==null?A(0,59,V.value):null),H=c(()=>{switch(i.value){case"hour":return h.value;case"minute":return b.value;case"second":return w.value}}),me=c(()=>{let e,t,n=0,o=1;const r=H.value!==null?H.value.values:void 0;i.value==="hour"?f.value===!0?(e=0,t=23):(e=0,t=11,v.value===!1&&(n=12)):(e=0,t=55,o=5);const m=[];for(let a=e,d=e;a<=t;a+=o,d++){const _=a+n,Oe=(r==null?void 0:r.includes(_))===!1,Ve=i.value==="hour"&&a===0?f.value===!0?"00":"12":a;m.push({val:_,index:d,disable:Oe,label:Ve})}return m}),he=c(()=>[[Qe,ke,void 0,{stop:!0,prevent:!0,mouse:!0}]]);ne(()=>u.modelValue,e=>{const t=F(e,D.value,S.value,u.calendar,J.value);(t.dateHash!==l.value.dateHash||t.timeHash!==l.value.timeHash)&&(l.value=t,t.hour===null?i.value="hour":v.value=t.hour<12)}),ne([D,S],()=>{Te(()=>{E()})});function R(){const e={...X(),...Je()};E(e),Object.assign(l.value,e),i.value="hour"}function A(e,t,n){const o=Array.apply(null,{length:t+1}).map((r,m)=>{const a=m+e;return{index:a,val:n(a)===!0}}).filter(r=>r.val===!0).map(r=>r.index);return{min:o[0],max:o[o.length-1],values:o,threshold:t+1}}function ee(e,t,n){const o=Math.abs(e-t);return Math.min(o,n-o)}function N(e,{min:t,max:n,values:o,threshold:r}){if(e===t)return t;if(e<t||e>n)return ee(e,t,r)<=ee(e,n,r)?t:n;const m=o.findIndex(_=>e<=_),a=o[m-1],d=o[m];return e-a<=d-e?a:d}function _e(){return u.calendar!=="persian"&&u.mask!==null?u.mask:`HH:mm${u.withSeconds===!0?":ss":""}`}function ge(){if(typeof u.defaultDate!="string"){const e=X(!0);return e.dateHash=We(e),e}return F(u.defaultDate,"YYYY/MM/DD",void 0,u.calendar)}function Q(){return Fe($)===!0||H.value!==null&&(H.value.values.length===0||i.value==="hour"&&f.value!==!0&&h.value[v.value===!0?"am":"pm"].values.length===0)}function Y(){const e=G.value,{top:t,left:n,width:o}=e.getBoundingClientRect(),r=o/2;return{top:t+r,left:n+r,dist:r*.7}}function ke(e){if(Q()!==!0){if(e.isFirst===!0){M=Y(),x=I(e.evt,M);return}x=I(e.evt,M,x),e.isFinal===!0&&(M=!1,x=null,te())}}function te(){i.value==="hour"?i.value="minute":u.withSeconds&&i.value==="minute"&&(i.value="second")}function I(e,t,n){const o=Be(e),r=Math.abs(o.top-t.top),m=Math.sqrt(Math.pow(Math.abs(o.top-t.top),2)+Math.pow(Math.abs(o.left-t.left),2));let a,d=Math.asin(r/m)*(180/Math.PI);if(o.top<t.top?d=t.left<o.left?90-d:270+d:d=t.left<o.left?d+90:270-d,i.value==="hour"){if(a=d/30,h.value!==null){const _=f.value!==!0?v.value===!0:h.value.am.values.length!==0&&h.value.pm.values.length!==0?m>=t.dist:h.value.am.values.length!==0;a=N(a+(_===!0?0:12),h.value[_===!0?"am":"pm"])}else a=Math.round(a),f.value===!0?m<t.dist?a<12&&(a+=12):a===12&&(a=0):v.value===!0&&a===12?a=0:v.value===!1&&a!==12&&(a+=12);f.value===!0&&(v.value=a<12)}else a=Math.round(d/6)%60,i.value==="minute"&&b.value!==null?a=N(a,b.value):i.value==="second"&&w.value!==null&&(a=N(a,w.value));return n!==a&&De[i.value](a),a}const z={hour(){i.value="hour"},minute(){i.value="minute"},second(){i.value="second"}};function ye(e){e.keyCode===13&&ue()}function qe(e){e.keyCode===13&&le()}function be(e){Q()!==!0&&(y.platform.is.desktop!==!0&&I(e,Y()),te())}function we(e){Q()!==!0&&I(e,Y())}function Ce(e){if(e.keyCode===13)i.value="hour";else if([37,39].includes(e.keyCode)){const t=e.keyCode===37?-1:1;if(h.value!==null){const n=f.value===!0?h.value.values:h.value[v.value===!0?"am":"pm"].values;if(n.length===0)return;if(l.value.hour===null)K(n[0]);else{const o=(n.length+n.indexOf(l.value.hour)+t)%n.length;K(n[o])}}else{const n=f.value===!0?24:12,o=f.value!==!0&&v.value===!1?12:0,r=l.value.hour===null?-t:l.value.hour;K(o+(24+r+t)%n)}}}function Me(e){if(e.keyCode===13)i.value="minute";else if([37,39].includes(e.keyCode)){const t=e.keyCode===37?-1:1;if(b.value!==null){const n=b.value.values;if(n.length===0)return;if(l.value.minute===null)T(n[0]);else{const o=(n.length+n.indexOf(l.value.minute)+t)%n.length;T(n[o])}}else{const n=l.value.minute===null?-t:l.value.minute;T((60+n+t)%60)}}}function xe(e){if(e.keyCode===13)i.value="second";else if([37,39].includes(e.keyCode)){const t=e.keyCode===37?-1:1;if(w.value!==null){const n=w.value.values;if(n.length===0)return;if(l.value.seconds===null)B(n[0]);else{const o=(n.length+n.indexOf(l.value.second)+t)%n.length;B(n[o])}}else{const n=l.value.second===null?-t:l.value.second;B((60+n+t)%60)}}}function K(e){l.value.hour!==e&&(l.value.hour=e,C())}function T(e){l.value.minute!==e&&(l.value.minute=e,C())}function B(e){l.value.second!==e&&(l.value.second=e,C())}const De={hour:K,minute:T,second:B};function ue(){v.value===!1&&(v.value=!0,l.value.hour!==null&&(l.value.hour-=12,C()))}function le(){v.value===!0&&(v.value=!1,l.value.hour!==null&&(l.value.hour+=12,C()))}function L(e){const t=u.modelValue;i.value!==e&&t!==void 0&&t!==null&&t!==""&&typeof t!="string"&&(i.value=e)}function C(){if(q.value!==null&&q.value(l.value.hour)!==!0){l.value=F(),L("hour");return}if(O.value!==null&&O.value(l.value.minute)!==!0){l.value.minute=null,l.value.second=null,L("minute");return}if(u.withSeconds===!0&&V.value!==null&&V.value(l.value.second)!==!0){l.value.second=null,L("second");return}l.value.hour===null||l.value.minute===null||u.withSeconds===!0&&l.value.second===null||E()}function E(e){const t=Object.assign({...l.value},e),n=u.calendar==="persian"?k(t.hour)+":"+k(t.minute)+(u.withSeconds===!0?":"+k(t.second):""):Xe(new Date(t.year,t.month===null?null:t.month-1,t.day,t.hour,t.minute,t.second,t.millisecond),D.value,S.value,t.year,t.timezoneOffset);t.changed=n!==u.modelValue,oe("update:modelValue",n,t)}function Se(){const e=[s("div",{class:"q-time__link "+(i.value==="hour"?"q-time__link--active":"cursor-pointer"),tabindex:g.value,onClick:z.hour,onKeyup:Ce},j.value.hour),s("div",":"),s("div",Z.value===!0?{class:"q-time__link "+(i.value==="minute"?"q-time__link--active":"cursor-pointer"),tabindex:g.value,onKeyup:Me,onClick:z.minute}:{class:"q-time__link"},j.value.minute)];u.withSeconds===!0&&e.push(s("div",":"),s("div",fe.value===!0?{class:"q-time__link "+(i.value==="second"?"q-time__link--active":"cursor-pointer"),tabindex:g.value,onKeyup:xe,onClick:z.second}:{class:"q-time__link"},j.value.second));const t=[s("div",{class:"q-time__header-label row items-center no-wrap",dir:"ltr"},e)];return f.value===!1&&t.push(s("div",{class:"q-time__header-ampm column items-between no-wrap"},[s("div",{class:"q-time__link "+(v.value===!0?"q-time__link--active":"cursor-pointer"),tabindex:g.value,onClick:ue,onKeyup:ye},"AM"),s("div",{class:"q-time__link "+(v.value!==!0?"q-time__link--active":"cursor-pointer"),tabindex:g.value,onClick:le,onKeyup:qe},"PM")])),s("div",{class:"q-time__header flex flex-center no-wrap "+W.value},t)}function pe(){const e=l.value[i.value];return s("div",{class:"q-time__content col relative-position"},[s($e,{name:"q-transition--scale"},()=>s("div",{key:"clock"+i.value,class:"q-time__container-parent absolute-full"},[s("div",{ref:G,class:"q-time__container-child fit overflow-hidden"},[je(s("div",{class:"q-time__clock cursor-pointer non-selectable",onClick:be,onMousedown:we},[s("div",{class:"q-time__clock-circle fit"},[s("div",{class:"q-time__clock-pointer"+(l.value[i.value]===null?" hidden":u.color!==void 0?` text-${u.color}`:""),style:de.value}),me.value.map(t=>s("div",{class:`q-time__clock-position row flex-center q-time__clock-pos-${t.index}`+(t.val===e?" q-time__clock-position--active "+W.value:t.disable===!0?" q-time__clock-position--disable":"")},[s("span",t.label)]))])]),he.value)])])),u.nowBtn===!0?s(Ne,{class:"q-time__now-button absolute",icon:y.iconSet.datetime.now,unelevated:!0,size:"sm",round:!0,color:u.color,textColor:u.textColor,tabindex:g.value,onClick:R}):null])}return $.proxy.setNow=R,()=>{const e=[pe()],t=Pe(U.default);return t!==void 0&&e.push(s("div",{class:"q-time__actions"},t)),u.name!==void 0&&u.disable!==!0&&ce(e,"push"),s("div",{class:ve.value,tabindex:-1},[Se(),s("div",{class:"q-time__main col overflow-auto"},e)])}}});export{lt as Q};
